<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مشغّل الفيديو</title>
  <link rel="icon" href="data:," />
  <style>
    :root {
      --primary-color: #38bdf8;
      --ui-bg: rgba(20, 20, 20, 0.75);
      --ui-text: #ffffff;
      --hover-bg: rgba(255, 255, 255, 0.15);
      --track-bg: rgba(255, 255, 255, 0.3);
      --font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      --transition-fast: all 0.2s ease-in-out;
      --transition-medium: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    html, body { margin:0; padding:0; background:#000; height:100%; font-family:var(--font-family); }
    #stage { position:absolute; inset:0; overflow:hidden; color:var(--ui-text); }
    video { width:100%; height:100%; display:block; background:#000; object-fit:contain; }

    .overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:10; pointer-events:none; opacity:0; transition:opacity .3s; }
    .overlay.visible { opacity:1; pointer-events:auto; }
    #gate { background:rgba(0,0,0,.5); cursor:pointer; }
    #gate-btn { width:72px; height:72px; border-radius:50%; background:var(--ui-bg); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,.1); display:flex; align-items:center; justify-content:center; transition:var(--transition-fast); }
    #gate:hover #gate-btn { background:var(--primary-color); transform:scale(1.1); }
    #gate-btn svg { fill:var(--ui-text); width:32px; height:32px; margin-left:4px; }

    #fallback { background:rgba(0,0,0,.9); flex-direction:column; gap:16px; font-size:16px; text-align:center; padding:1rem; }
    .retry-btn { padding:10px 20px; background:var(--primary-color); color:#fff; border:none; border-radius:8px; font-size:15px; cursor:pointer; transition:var(--transition-fast); }
    .retry-btn:hover { background:#0ea5e9; }

    #loadingSpinner { width:48px; height:48px; border:4px solid var(--track-bg); border-top-color:var(--primary-color); border-radius:50%; animation:spin 1s linear infinite; z-index:15; }
    @keyframes spin { to { transform: rotate(360deg); } }

    #controls-container { position:absolute; bottom:0; left:0; right:0; z-index:20; padding:0 16px; background:linear-gradient(to top, rgba(0,0,0,.7), transparent); opacity:0; transform:translateY(100%); transition:opacity var(--transition-medium), transform var(--transition-medium); }
    #stage.controls-visible #controls-container, #stage.paused #controls-container { opacity:1; transform:translateY(0); }

    #progressContainer { position:relative; width:100%; height:16px; cursor:pointer; padding:6px 0; }
    .progress-track, #progressBar { position:absolute; top:50%; transform:translateY(-50%); height:4px; border-radius:2px; width:100%; }
    .progress-track { background:var(--track-bg); }
    #progressBar { background:var(--primary-color); width:0; }
    #progressHandle { position:absolute; top:50%; left:0; width:12px; height:12px; background:var(--ui-text); border-radius:50%; transform:translate(-50%, -50%) scale(0); transition:transform .2s; }
    #progressContainer:hover #progressHandle { transform:translate(-50%, -50%) scale(1); }

    .controls-row { display:flex; align-items:center; justify-content:space-between; padding-bottom:8px; }
    .controls-group { display:flex; align-items:center; gap:8px; }
    .control-btn { background:none; border:none; color:var(--ui-text); cursor:pointer; padding:8px; border-radius:50%; display:flex; transition:background var(--transition-fast); }
    .control-btn:hover { background:var(--hover-bg); }
    .control-btn:focus-visible { outline:2px solid var(--primary-color); outline-offset:2px; }
    .control-btn svg { width:22px; height:22px; fill:currentColor; }

    #timeDisplay { font-size:14px; font-variant-numeric: tabular-nums; }
    .volume-controls { display:flex; align-items:center; }
    #volumeSliderContainer { width:0; transition:width .3s; overflow:hidden; }
    .volume-controls:hover #volumeSliderContainer { width:80px; }
    #volumeSlider { width:80px; height:4px; background:var(--track-bg); border-radius:2px; cursor:pointer; position:relative; }
    #volumeLevel { height:100%; background:var(--ui-text); border-radius:2px; }

    /* === جودة: وضع Fixed + تموضع ذكي === */
    #qualityMenu {
      position: fixed;      /* مهم: عشان ما تطلع برا الشاشة */
      left: 0; top: 0;      /* سيُعدّلان بالـ JS */
      right: auto; bottom: auto;
      background: var(--ui-bg); backdrop-filter: blur(12px);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      min-width: 150px; max-width: 280px;
      max-height: min(60vh, 360px);
      overflow-y: auto;
      padding: 6px;
      opacity: 0; pointer-events: none;
      transition: var(--transition-fast);
      z-index: 40;
      transform-origin: top right;
    }
    #qualityMenu.show { opacity: 1; pointer-events: auto; }

    .quality-option {
      width: 100%; text-align: right; background: none; border: none;
      color: var(--ui-text); padding: 8px 12px; border-radius: 8px;
      font-size: 14px; cursor: pointer; display: flex; justify-content: flex-end;
      align-items: center; gap: 10px; transition: var(--transition-fast);
    }
    .quality-option:hover { background: var(--hover-bg); }
    .quality-option.active { color: var(--primary-color); font-weight: bold; }
    .quality-option .dot { width: 6px; height: 6px; background-color: var(--primary-color); border-radius: 50%; opacity: 0; transition: opacity .2s; }
    .quality-option.active .dot { opacity: 1; }

    /* زر إغلاق (يظهر فقط في الموبايل) */
    #qualityCloseBtn {
      display: none;
      background: transparent; color: var(--ui-text);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 10px;
      padding: 10px 12px; margin: 6px 0 4px;
      width: 100%; text-align: center;
    }

    /* Bottom Sheet للموبايل */
    @media (max-width: 640px) {
      #qualityMenu.mobile {
        left: 0 !important; right: 0 !important;
        bottom: 0 !important; top: auto !important;
        width: 100vw !important; max-width: 100vw !important;
        border-radius: 16px 16px 0 0 !important;
        padding: 8px !important;
        transform: none !important;
      }
      #qualityCloseBtn { display: block; }
      .quality-option { padding: 12px 16px; font-size: 16px; }
    }

    .tap-zone { position:absolute; top:0; bottom:0; width:35%; z-index:5; }
    #tapLeft { left:0; } #tapRight { right:0; }
    .nudge { position:absolute; top:50%; width:64px; height:64px; margin-top:-32px; border-radius:50%; background:var(--ui-bg); display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:12px; font-weight:bold; opacity:0; transform:scale(.8); transition:all .4s; z-index:15; }
    .nudge.show { opacity:1; transform:scale(1); }
    .nudge svg { width:24px; height:24px; fill:var(--ui-text); margin-bottom:2px; }
    #nudgeLeft { left:5%; } #nudgeRight { right:5%; }

    video::-webkit-media-controls { display:none !important; }

    /* Thumbnail Preview */
    #thumbnailPreview { position:absolute; bottom:80px; background:#000; border:1px solid #555; border-radius:4px; width:160px; height:90px; background-size:cover; background-position:center; opacity:0; pointer-events:none; transform:translateX(-50%) scale(.8); transition:opacity .2s, transform .2s; display:flex; flex-direction:column-reverse; }
    #thumbnailPreview.visible { opacity:1; transform:translateX(-50%) scale(1); }
    #thumbnailTime { width:100%; text-align:center; background:rgba(0,0,0,.6); padding:2px 0; font-size:13px; }

    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="stage">
    <video id="v" preload="metadata" playsinline></video>
    <div id="loadingSpinner" class="overlay"></div>
    <div id="gate" class="overlay visible">
      <div id="gate-btn">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
      </div>
    </div>
    <div id="fallback" class="overlay">
      <span>تعذّر تشغيل الفيديو.</span>
      <button class="retry-btn" id="retryBtn">إعادة المحاولة</button>
    </div>
    <div id="tapLeft" class="tap-zone"></div>
    <div id="tapRight" class="tap-zone"></div>
    <div id="nudgeLeft" class="nudge">
      <svg viewBox="0 0 24 24"><path d="M11.99 5V1l-5 4 5 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H3.99c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path></svg>
      -10s
    </div>
    <div id="nudgeRight" class="nudge">
      <svg viewBox="0 0 24 24"><path d="M12.01 5V1l5 4-5 4V6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"></path></svg>
      +10s
    </div>
    <div id="controls-container">
      <div id="progressContainer">
        <div id="thumbnailPreview"><span id="thumbnailTime">00:00</span></div>
        <div class="progress-track"></div>
        <div id="progressBar"></div>
        <div id="progressHandle"></div>
      </div>
      <div class="controls-row">
        <div class="controls-group">
          <button class="control-btn" id="playPauseBtn" aria-label="تشغيل/إيقاف مؤقت">
            <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg id="pauseIcon" viewBox="0 0 24 24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
          </button>
          <div class="volume-controls">
            <button class="control-btn" id="volumeBtn" aria-label="كتم/إلغاء كتم الصوت">
              <svg id="volumeIcon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
              <svg id="muteIcon" viewBox="0 0 24 24" style="display: none;"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
            </button>
            <div id="volumeSliderContainer">
              <div id="volumeSlider"><div id="volumeLevel"></div></div>
            </div>
          </div>
          <span id="timeDisplay">00:00 / 00:00</span>
        </div>
        <div class="controls-group">
          <div style="position: relative;">
            <div id="qualityMenu"></div>
            <button class="control-btn" id="settingsBtn" aria-label="الإعدادات والجودة">
              <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.22,5.23C8.63,5.46,8.1,5.79,7.6,6.17L5.21,5.21C4.99,5.14,4.74,5.21,4.62,5.43L2.7,8.75 c-0.11,0.2-0.06,0.47,0.12,0.61l2.03,1.58C4.8,11.36,4.78,11.68,4.78,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.38,2.42 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44,0.17,0.48,0.41l0.38-2.42c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0.01,0.59-0.22l1.92-3.32c0.11-0.2,0.06-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"></path></svg>
            </button>
          </div>
          <button class="control-btn" id="fullscreenBtn" aria-label="ملء الشاشة/الخروج من ملء الشاشة">
            <svg id="fullscreenEnterIcon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
            <svg id="fullscreenExitIcon" viewBox="0 0 24 24" style="display: none;"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script defer src="/players/hls.min.js"></script>
  <script defer src="/players/hls-player.js"></script>
</body>
</html>
