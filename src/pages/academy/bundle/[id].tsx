// src/pages/academy/bundle/[id].tsx
"use client";

import React, { useMemo, useEffect, useRef, useState, ReactNode } from "react";
import { useRouter } from "next/router";
import Link from "next/link";
import dynamic from "next/dynamic";
import { motion, useScroll, useTransform } from "framer-motion";
import { useAcademyData } from "@/domains/academy/api";
import { useTelegram } from "@/shared/context/TelegramContext";
import AuthPrompt from "@/domains/auth/components/AuthFab";
import SmartImage from "@/shared/components/common/SmartImage";
import { Card } from "@/shared/components/ui/card";
import { Button } from "@/shared/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/shared/components/ui/tabs";
const AcademyPurchaseModal = dynamic(
  () => import("@/domains/academy/components/AcademyPurchaseModal"),
  { ssr: false },
);
import PageLayout from "@/shared/components/layout/PageLayout";
import { PageLoader } from "@/shared/components/ui/loaders";
import { EmptyState } from "@/shared/components/common/EmptyState";
import { 
  ArrowLeft, 
  Package, 
  BookOpen, 
  MessageCircle, 
  Users, 
  Headphones, 
  Tag, 
  Crown,
  ChevronRight
} from "lucide-react";
import { colors, spacing } from "@/styles/tokens";


/* ==============================
   Types
============================== */
interface Course {
  id: string;
  title: string;
  instructor_name?: string;
  total_number_of_lessons: number;
  thumbnail?: string;
  level?: string;
  price?: string;
  is_free_course?: string | null;
  short_description?: string;
}
interface Bundle {
  id: string;
  title: string;
  description?: string;
  cover_image?: string;
  image?: string;
  price: string;
  course_ids: string;
  free_sessions_count?: string;
  telegram_url?: string;
}

/* ==============================
   Sub-Components
============================== */

// CourseHeader Component
interface CourseHeaderProps {
  title: string;
  subtitle: string;
  imageUrl: string;
  onBack?: () => void;
}

function CourseHeader({ title, subtitle, imageUrl, onBack }: CourseHeaderProps) {
  return (
    <div className="relative h-[400px] rounded-b-3xl overflow-hidden">
      <div className="absolute inset-0">
        <SmartImage
          src={imageUrl}
          alt={subtitle}
          fill
          blurType="secondary"
          className="object-cover"
          sizes="100vw"
          priority
        />
        <div className="absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/50"></div>
      </div>

      <button
        onClick={onBack}
        className="absolute top-4 left-4 z-10 w-10 h-10 bg-black/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-white transition-all hover:bg-black/30"
        aria-label="ÿ±ÿ¨Ÿàÿπ"
      >
        <ArrowLeft size={24} />
      </button>

      <div className="absolute top-4 right-4 left-16 z-10 text-white text-center">
        <h1 className="text-xl drop-shadow-lg">{title}</h1>
      </div>

      <div className="absolute bottom-8 left-0 right-0 text-center text-white z-10">
        <p className="text-sm opacity-90 drop-shadow-lg">(BUNDLE)</p>
      </div>

      <div 
        className="absolute bottom-6 right-6 rounded-full px-4 py-2 flex items-center shadow-lg z-10"
        style={{
          backgroundColor: colors.bg.primary,
          gap: spacing[2]
        }}
      >
        <span style={{ color: colors.status.error, fontWeight: 600 }}>NEW</span>
        <span>üë®‚Äçüéì</span>
      </div>
    </div>
  );
}

// CourseFeature Component
interface CourseFeatureProps {
  icon: ReactNode;
  title: string;
  description: string;
}

function CourseFeature({ icon, title, description }: CourseFeatureProps) {
  return (
    <div 
      className="rounded-2xl p-4 flex"
      style={{ 
        backgroundColor: colors.bg.secondary,
        gap: spacing[4]
      }}
    >
      <div 
        className="flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center"
        style={{ backgroundColor: colors.bg.primary }}
      >
        {icon}
      </div>
      <div className="flex-1">
        <h3 className="mb-1 font-semibold" style={{ color: colors.text.primary }}>
          {title}
        </h3>
        <p className="text-sm" style={{ color: colors.text.secondary }}>
          {description}
        </p>
      </div>
    </div>
  );
}

// CourseListItem Component
interface CourseListItemProps {
  title: string;
  icon: string;
  onClick?: () => void;
}

function CourseListItem({ title, icon, onClick }: CourseListItemProps) {
  return (
    <button
      onClick={onClick}
      className="w-full flex items-center py-4 border-b transition-colors"
      style={{
        gap: spacing[3],
        borderColor: colors.border.default
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.backgroundColor = colors.bg.secondary;
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.backgroundColor = 'transparent';
      }}
    >
      <div 
        className="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 text-white"
        style={{
          background: `linear-gradient(135deg, ${colors.brand.primary} 0%, ${colors.brand.primaryHover} 100%)`
        }}
      >
        {icon}
      </div>
      <span className="flex-1 text-right" style={{ color: colors.text.primary }}>
        {title}
      </span>
      <ChevronRight size={20} style={{ color: colors.text.tertiary }} />
    </button>
  );
}

/* ==============================
   Helpers
============================== */
const isFreeCourse = (c: Pick<Course, "price" | "is_free_course">) =>
  (c.is_free_course ?? "") === "1" || c.price?.toLowerCase?.() === "free";

const formatPrice = (value?: string) => {
  if (!value) return "";
  if (value.toLowerCase?.() === "free") return "ŸÖÿ¨ÿßŸÜŸä";
  const n = Number(value);
  return isNaN(n) ? value : `$${n.toFixed(0)}`;
};


/* ==============================
   Page
============================== */
export default function BundleDetail() {
  const router = useRouter();
  const id = (router.query.id as string) || "";
  const { telegramId } = useTelegram();
  const { data, isLoading, isError, error } = useAcademyData(
    telegramId || undefined,
  );

  const [showSticky, setShowSticky] = useState(false);
  useEffect(() => {
    const onScroll = () => setShowSticky(window.scrollY > 500);
    onScroll();
    window.addEventListener("scroll", onScroll, { passive: true });
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  const heroRef = useRef<HTMLDivElement>(null);
  const { scrollY } = useScroll();
  const y = useTransform(scrollY, [0, 300], [0, 60]);
  const scale = useTransform(scrollY, [0, 300], [1, 1.05]);

  const bundle: Bundle | undefined = useMemo(
    () => data?.bundles.find((b: Bundle) => b.id === id),
    [data, id],
  );

  const coursesInBundle: Course[] = useMemo(() => {
    if (!data || !bundle) return [];
    try {
      const ids = new Set<string>(JSON.parse(bundle.course_ids));
      return data.courses.filter((c: Course) => ids.has(c.id));
    } catch {
      return [];
    }
  }, [data, bundle]);

  const isEnrolled =
    Boolean((data as any)?.my_enrollments?.bundle_ids?.includes?.(id)) || false;
  const isFree =
    bundle?.price?.toLowerCase?.() === "free" || Number(bundle?.price) === 0;

  const onCTA = () => {
    if (isEnrolled) {
      router.push(`/academy/bundle/${id}`);
      return;
    }
    window.dispatchEvent(
      new CustomEvent("open-subscribe", {
        detail: {
          productType: "bundle",
          productId: id,
          title: bundle?.title,
          price: bundle?.price,
          telegramUrl: bundle?.telegram_url?.trim() || null,
        },
      }),
    );
  };

  if (isLoading) return <PageLoader />;

  if (isError)
    return (
      <EmptyState
        icon={Package}
        title="ÿ™ÿπÿ∞Ÿëÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ"
        description={(error as Error)?.message}
      />
    );

  if (!bundle && !isLoading)
    return (
      <EmptyState
        icon={Package}
        title="ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ≠ÿ≤ŸÖÿ©"
        description="ÿπÿ∞ÿ±Ÿãÿßÿå ÿßŸÑÿ≠ÿ≤ŸÖÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©"
      />
    );

  if (!bundle) return null;

  return (
    <div dir="rtl" className="min-h-screen" style={{ backgroundColor: colors.bg.primary }}>
      {/* Course Header with Image */}
      <CourseHeader
        title={bundle.title}
        subtitle={bundle.title}
        imageUrl={bundle.cover_image || bundle.image || "/image.jpg"}
        onBack={() => router.push("/academy")}
      />

      {/* Content */}
      <div className="px-4 py-6 max-w-2xl mx-auto">
        {/* Premium Badge */}
        <div className="flex items-center justify-center mb-6" style={{ gap: spacing[2] }}>
          <Crown size={24} style={{ color: colors.text.secondary }} />
          <h2 style={{ color: colors.text.primary }}>{bundle.title}</h2>
        </div>

        {/* Description */}
        <div className="mb-6 text-center space-y-1" style={{ color: colors.text.secondary }}>
          {(bundle.description || "").split("\n").map((line, index) => (
            <p key={index}>{line}</p>
          ))}
        </div>

        {/* Features */}
        <div className="space-y-3 mb-6">
          <CourseFeature
            icon={<BookOpen size={24} style={{ color: colors.brand.primary }} />}
            title="ŸÖÿ≠ÿ™ŸàŸâ ÿ™ÿπŸÑŸäŸÖŸä ÿ∫ŸÜŸä"
            description={`ÿ≥ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ${coursesInBundle.length} ÿØŸàÿ±ÿßÿ™ ÿ™ÿØÿ±Ÿäÿ®Ÿäÿ© ŸÖÿπ ${coursesInBundle.reduce((acc, c) => acc + c.total_number_of_lessons, 0)} ÿØÿ±ÿ≥`}
          />
          
          {parseInt(bundle.free_sessions_count || "0") > 0 && (
            <CourseFeature
              icon={
                <div 
                  className="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold"
                  style={{ backgroundColor: colors.brand.primary }}
                >
                  zoom
                </div>
              }
              title="ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿßÿ™ ŸÖÿ¨ÿßŸÜŸäÿ©"
              description={`ÿ≥ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ${bundle.free_sessions_count} ÿ¨ŸÑÿ≥ÿßÿ™ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÖÿπ ÿÆÿ®Ÿäÿ± ÿ£ŸÉÿ≥ÿßÿØŸà üíô`}
            />
          )}
          
          {bundle.telegram_url?.trim() && (
            <CourseFeature
              icon={<Users size={24} style={{ color: colors.brand.primary }} />}
              title="ŸÖÿ¨ŸÖŸàÿπÿ© ŸÜŸÇÿßÿ¥"
              description="ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿØÿÆŸàŸÑ ŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÜŸÇÿßÿ¥ ÿßŸÑÿÆÿßÿµÿ© ŸàŸÜÿØŸàÿßÿ™ ÿ£ÿ≥ÿ®ŸàÿπŸäÿ©"
            />
          )}
          
          <CourseFeature
            icon={<Headphones size={24} style={{ color: colors.brand.primary }} />}
            title="ÿØÿπŸÖ ŸÅŸÜŸä 24/7"
            description="ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿØÿπŸÖ ŸÖŸÜ ÿÆÿ®ÿ±ÿßÿ° ÿ£ŸÉÿ≥ÿßÿØŸà ŸÅŸä ÿ£Ÿä ŸàŸÇÿ™"
          />
          
          <CourseFeature
            icon={<Tag size={24} style={{ color: colors.brand.primary }} />}
            title="ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä"
            description={formatPrice(bundle.price)}
          />
        </div>

        {/* Tabs */}
        <Tabs defaultValue="courses" className="mb-6">
          <TabsList className="w-full grid grid-cols-3">
            <TabsTrigger value="courses">ÿßŸÑÿØŸàÿ±ÿßÿ™</TabsTrigger>
            <TabsTrigger value="output">ÿßŸÑŸÖÿÆÿ±ÿ¨ÿßÿ™</TabsTrigger>
            <TabsTrigger value="requirements">ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™</TabsTrigger>
          </TabsList>
          
          <TabsContent value="courses" className="mt-6">
            <div className="flex items-center justify-between mb-4">
              <BookOpen size={24} style={{ color: colors.brand.primary }} />
              <h3 style={{ color: colors.text.primary }}>ÿßŸÑÿØŸàÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ÿ∂ŸÖŸÜÿ©</h3>
            </div>
            
            <div className="space-y-0">
              {coursesInBundle.map((course) => (
                <CourseListItem
                  key={course.id}
                  title={course.title}
                  icon="üìö"
                  onClick={() => router.push(`/academy/course/${course.id}`)}
                />
              ))}
            </div>
          </TabsContent>
          
          <TabsContent value="output" className="mt-6">
            <div 
              className="p-6 rounded-xl"
              style={{ backgroundColor: colors.bg.elevated }}
            >
              <div className="flex items-center mb-4" style={{ gap: spacing[3] }}>
                <div 
                  className="w-10 h-10 rounded-xl flex items-center justify-center"
                  style={{ backgroundColor: colors.status.warning }}
                >
                  <span className="text-white text-xl">üéØ</span>
                </div>
                <h3 style={{ color: colors.text.primary }}>ŸÖÿßÿ∞ÿß ÿ≥ÿ™ÿ™ÿπŸÑŸÖ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿ≠ÿ≤ŸÖÿ©</h3>
              </div>
              
              <ul className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.status.success}25`,
                      color: colors.status.success
                    }}
                  >
                    ‚úì
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿ•ÿ™ŸÇÿßŸÜ {coursesInBundle.length} ÿØŸàÿ±ÿßÿ™ ÿ™ÿØÿ±Ÿäÿ®Ÿäÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÅŸä ŸÖÿ¨ÿßŸÑ Ÿàÿßÿ≠ÿØ
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.status.success}25`,
                      color: colors.status.success
                    }}
                  >
                    ‚úì
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÖŸÑŸä ÿπŸÑŸâ {coursesInBundle.reduce((acc, c) => acc + c.total_number_of_lessons, 0)} ÿØÿ±ÿ≥ ÿ™ŸÅÿßÿπŸÑŸä
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.status.success}25`,
                      color: colors.status.success
                    }}
                  >
                    ‚úì
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¥ŸáÿßÿØÿßÿ™ ŸÖÿπÿ™ŸÖÿØÿ© ŸÑŸÉŸÑ ÿØŸàÿ±ÿ© ŸÅŸä ÿßŸÑÿ≠ÿ≤ŸÖÿ©
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.status.success}25`,
                      color: colors.status.success
                    }}
                  >
                    ‚úì
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿ®ŸÜÿßÿ° portfolio ÿπŸÖŸÑŸä ŸàŸÖÿ¥ÿßÿ±Ÿäÿπ ÿ≠ŸÇŸäŸÇŸäÿ©
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.status.success}25`,
                      color: colors.status.success
                    }}
                  >
                    ‚úì
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿßŸÑÿ™ŸÅÿßÿπŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÖÿπ ÿßŸÑŸÖÿØÿ±ÿ®ŸäŸÜ ŸàÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.status.success}25`,
                      color: colors.status.success
                    }}
                  >
                    ‚úì
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ŸàÿµŸàŸÑ ŸÖÿØŸâ ÿßŸÑÿ≠Ÿäÿßÿ© ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ŸàÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™
                  </span>
                </li>
              </ul>
            </div>
          </TabsContent>
          
          <TabsContent value="requirements" className="mt-6">
            <div 
              className="p-6 rounded-xl"
              style={{ backgroundColor: colors.bg.elevated }}
            >
              <div className="flex items-center mb-4" style={{ gap: spacing[3] }}>
                <div 
                  className="w-10 h-10 rounded-xl flex items-center justify-center"
                  style={{ backgroundColor: colors.brand.primary }}
                >
                  <span className="text-white text-xl">üìã</span>
                </div>
                <h3 style={{ color: colors.text.primary }}>ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™</h3>
              </div>
              
              <ul className="space-y-3">
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.brand.primary}25`,
                      color: colors.brand.primary
                    }}
                  >
                    ‚Ä¢
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿ¨Ÿáÿßÿ≤ ŸÉŸÖÿ®ŸäŸàÿ™ÿ± ÿ£Ÿà Ÿáÿßÿ™ŸÅ ÿ∞ŸÉŸä ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.brand.primary}25`,
                      color: colors.brand.primary
                    }}
                  >
                    ‚Ä¢
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿßŸÑÿ±ÿ∫ÿ®ÿ© ŸÅŸä ÿßŸÑÿ™ÿπŸÑŸÖ ŸàÿßŸÑÿßŸÑÿ™ÿ≤ÿßŸÖ ÿ®ÿ•ŸÉŸÖÿßŸÑ ÿßŸÑÿØŸàÿ±ÿßÿ™
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.brand.primary}25`,
                      color: colors.brand.primary
                    }}
                  >
                    ‚Ä¢
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ŸÖÿ≥ÿ®ŸÇÿ© - ŸÖŸÜÿßÿ≥ÿ® ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™
                  </span>
                </li>
                <li className="flex items-start" style={{ gap: spacing[2] }}>
                  <span 
                    className="inline-block w-5 h-5 mt-0.5 rounded-full flex items-center justify-center flex-shrink-0"
                    style={{
                      backgroundColor: `${colors.brand.primary}25`,
                      color: colors.brand.primary
                    }}
                  >
                    ‚Ä¢
                  </span>
                  <span style={{ color: colors.text.secondary }}>
                    ÿ≥ÿßÿπÿßÿ™ ŸÉÿßŸÅŸäÿ© ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿπŸÖŸÑŸä ÿπŸÑŸâ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ
                  </span>
                </li>
              </ul>
              
              <div 
                className="mt-6 p-4 rounded-lg"
                style={{
                  backgroundColor: `${colors.brand.primary}10`,
                  borderRight: `4px solid ${colors.brand.primary}`
                }}
              >
                <p style={{ color: colors.text.secondary }}>
                  üí° <strong>ŸÜÿµŸäÿ≠ÿ©:</strong> Ÿáÿ∞Ÿá ÿßŸÑÿ≠ÿ≤ŸÖÿ© ŸÖÿµŸÖŸÖÿ© ŸÑÿ™ÿ£ÿÆÿ∞ŸÉ ŸÖŸÜ ÿßŸÑŸÖÿ®ÿ™ÿØÿ¶ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≠ÿ™ÿ±ŸÅ ÿÆÿ∑Ÿàÿ© ÿ®ÿÆÿ∑Ÿàÿ©. 
                  ŸÉŸÑ ŸÖÿß ÿ™ÿ≠ÿ™ÿßÿ¨Ÿá ŸáŸà ÿßŸÑÿßŸÑÿ™ÿ≤ÿßŸÖ ŸàÿßŸÑÿ±ÿ∫ÿ®ÿ© ŸÅŸä ÿßŸÑÿ™ÿπŸÑŸÖ!
                </p>
              </div>
            </div>
          </TabsContent>
        </Tabs>

        {/* Spacer for fixed button */}
        <div className="h-24"></div>
      </div>

      {/* Fixed Enroll Button */}
      <div 
        className="fixed bottom-0 left-0 right-0 p-4 shadow-lg z-20"
        style={{ 
          backgroundColor: colors.bg.primary,
          borderTop: `1px solid ${colors.border.default}`
        }}
      >
        <div className="max-w-2xl mx-auto">
          <Button 
            onClick={onCTA}
            className="w-full rounded-xl py-6"
            style={{
              backgroundColor: colors.brand.primary,
              color: colors.text.inverse
            }}
          >
            {isEnrolled ? "ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿØŸàÿ±ÿ©" : `ÿßÿ¥ÿ™ÿ±ŸÉ ÿßŸÑÿ¢ŸÜ üî• - ${formatPrice(bundle.price)}`}
          </Button>
        </div>
      </div>

      <AcademyPurchaseModal />
      <AuthPrompt />
    </div>
  );
}
